# systemPatterns.md

## システムアーキテクチャ (MVP)
- **フロントエンド:** シングルページアプリケーション (SPA) として実装。
    - HTML: 構造定義
    - CSS (Tailwind CSS): スタイリング
    - JavaScript: 動的なUI操作、データ処理、Firebase連携
- **バックエンド:** Firebase (BaaS)
    - **Firebase Realtime Database:**
        - アプリケーションデータの保存（基本情報、建物情報、劣化情報）。
        - リアルタイム同期による複数ユーザー間のデータ共有。
        - データ構造は現場名 -> 建物名 -> 劣化情報の階層構造を基本とする。
    - **Firebase Hosting:**
        - 静的ファイル（HTML, CSS, JS）のホスティングとデプロイ。

## コンポーネント間の関係
- **UI (HTML/CSS/JS):** ユーザーからの入力を受け付け、表示を更新する。
- **JavaScript Logic:**
    - UIイベント（ボタンクリック、入力など）を処理。
    - データのバリデーション、加工。
    - 予測変換リストの生成と表示。
    - Firebase Realtime Databaseとのデータの読み書きを行う。
    - CSVデータの生成。
- **Firebase Realtime Database:**
    - JS Logicからの要求に応じてデータを永続化。
    - データ変更時に接続中の全クライアントに変更をリアルタイムに通知。

## 採用している設計パターン
- **Observer パターン:** Firebase Realtime Databaseのリアルタイムリスナーを利用し、データ変更を検知してUIを自動更新する。
- **Module パターン (JavaScript):** 機能ごと（例: UI制御、Firebase連携、データ処理）にコードを分割し、保守性を高める（予定）。
- **Single Page Application (SPA):** ページ全体のリロードなしに、タブ切り替えやデータ更新を行う。

## 実装上の重要な経路
1.  **データ入力フロー:** ユーザー入力 -> JSでの処理・バリデーション -> Firebaseへの書き込み -> (リアルタイム通知) -> 他のユーザー/自身のUI更新。
2.  **データ表示フロー:** Firebaseからのデータ読み込み (初回 + リアルタイム更新) -> JSでのデータ整形 -> UIへのレンダリング。
3.  **予測変換フロー:** ユーザー入力 -> JSで入力値に基づき予測変換リスト (静的データ) をフィルタリング -> UIに候補表示 -> ユーザー選択 -> 入力フィールド更新。
4.  **CSVエクスポートフロー:** ユーザー操作 -> JSでFirebaseから該当建物のデータを取得 -> CSV形式にフォーマット -> ダウンロード処理。 